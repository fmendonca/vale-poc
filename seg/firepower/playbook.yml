---
- name: Configurar regra de firewall 1:1 no Cisco Firepower
  hosts: all
  connection: local
  gather_facts: no
  collections:
    - community.network

  tasks:

    - name: Gerar UUID para parentId
      set_fact:
        parentId_ran: "{{ lookup('pipe', 'uuidgen') }}"

    - name: Configurar a regra de acesso correspondente
      ftd_configuration:
        operation: "addAccessRule"
        path_params:
          parentId: "{{ parentId_ran }}"
        query_params: {}
        data:
          name: "{{ nat_rule_name }}"
          type: "accessRule"
          action: "allow"
          enabled: true
          sourceZone: "outside_zone"
          destinationZone: "inside_zone"
          sourceNetworks:
            - type: "network"
              value: "{{ source_ip }}"  # Substitua pelo IP de origem
          destinationNetworks:
            - type: "network"
              value: "{{ destination_ip }}"  # Substitua pela URL ou IP de destino
          sourcePorts: 
            - objectId: "{{ source_port }}"
          destinationPorts: 
            - port: "{{ destination_port }}"
              protocol: "{{ protocol }}"